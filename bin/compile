#!/bin/sh

### Load dependencies

source $BP_DIR/lib/output.sh
source $BP_DIR/lib/json.sh
source $BP_DIR/lib/failure.sh
source $BP_DIR/lib/environment.sh
source $BP_DIR/lib/binaries.sh
source $BP_DIR/lib/cache.sh
source $BP_DIR/lib/dependencies.sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Found a tsconfig.json"

# if tscongif.json is empty, abort the build
if [ ! -s $1/tsconfig.json ]; then
  echo "tsconfig.json was empty" | indent
  exit 1
else 
  # check if the file can be parsed
  local ts_engine=$(read_json "$BUILD_DIR/package.json" ".engines.typescript")
  if [ ! -n "$ts_engine"]; then
    echo "Installing Typescript" | indent
    npm install -g typescript@"$ts_engine"
    tsc
    exit 1
  fi
fi

